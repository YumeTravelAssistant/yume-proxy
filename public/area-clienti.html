<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Area Clienti – YUTA</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/styles-dark.css">

</head>
<body>
<button class="hamburger" onclick="toggleSidebar()">☰</button>
<div class="sidebar">
  <img src="assets/logo-yuta.jpg" alt="Logo YUTA">
  <h2>YUTA</h2>
  <a href="home.html">Home</a>
  <a href="index.html">YUTA</a>
  <a href="yuta.html">Cos'è YUTA</a>
  <a href="chi-siamo.html">Chi siamo</a>
  <a href="contatti.html">Contatti</a>
  <a href="faq.html">FAQ</a>
  <a href="profilo.html">Registrazione</a>
  <a href="log-in.html">Area Personale</a>
</div>
<div class="main-wrapper">
  <div class="main-content">
    <h1>Area Clienti</h1>
    <form id="modificaForm">
      <!-- Qui inseriremo dinamicamente i campi dal JS -->
    </form>
    <button onclick="salvaModifiche()">Salva modifiche</button>
  </div>
</div>
<script>
function toggleSidebar() {
  document.querySelector('.sidebar').classList.toggle('active');
}
const CAMPI_DEFINITI = {
  nome: { tipo: "text", label: "Nome e Cognome" },
  email: { tipo: "email", label: "Email" },

nazionalita: {
  tipo: "select-singola",
  opzioni: [
    "Italia",
    "Afghanistan",
    "Albania",
    "Algeria",
    "Andorra",
    "Angola",
    "Antigua e Barbuda",
    "Arabia Saudita",
    "Argentina",
    "Armenia",
    "Australia",
    "Austria",
    "Azerbaigian",
    "Bahamas",
    "Bahrein",
    "Bangladesh",
    "Barbados",
    "Belgio",
    "Belize",
    "Benin",
    "Bhutan",
    "Bielorussia",
    "Birmania (Myanmar)",
    "Bolivia",
    "Bosnia ed Erzegovina",
    "Botswana",
    "Brasile",
    "Brunei",
    "Bulgaria",
    "Burkina Faso",
    "Burundi",
    "Cambogia",
    "Camerun",
    "Canada",
    "Capo Verde",
    "Ciad",
    "Cile",
    "Cina",
    "Cipro",
    "Colombia",
    "Comore",
    "Congo (Repubblica)",
    "Congo (R.D.)",
    "Corea del Nord",
    "Corea del Sud",
    "Costa d'Avorio",
    "Costa Rica",
    "Croazia",
    "Cuba",
    "Danimarca",
    "Dominica",
    "Ecuador",
    "Egitto",
    "El Salvador",
    "Emirati Arabi Uniti",
    "Eritrea",
    "Estonia",
    "Eswatini",
    "Etiopia",
    "Fiji",
    "Filippine",
    "Finlandia",
    "Francia",
    "Gabon",
    "Gambia",
    "Georgia",
    "Germania",
    "Ghana",
    "Giamaica",
    "Giappone",
    "Gibilterra",
    "Gibuti",
    "Giordania",
    "Grecia",
    "Grenada",
    "Guatemala",
    "Guinea",
    "Guinea-Bissau",
    "Guinea Equatoriale",
    "Guyana",
    "Haiti",
    "Honduras",
    "India",
    "Indonesia",
    "Iran",
    "Iraq",
    "Irlanda",
    "Islanda",
    "Israele",
    "Kazakistan",
    "Kenya",
    "Kirghizistan",
    "Kiribati",
    "Kuwait",
    "Laos",
    "Lesotho",
    "Lettonia",
    "Libano",
    "Liberia",
    "Libia",
    "Liechtenstein",
    "Lituania",
    "Lussemburgo",
    "Macedonia del Nord",
    "Madagascar",
    "Malawi",
    "Malaysia",
    "Maldive",
    "Mali",
    "Malta",
    "Marocco",
    "Marshall",
    "Mauritania",
    "Mauritius",
    "Messico",
    "Micronesia",
    "Moldavia",
    "Monaco",
    "Mongolia",
    "Montenegro",
    "Mozambico",
    "Namibia",
    "Nauru",
    "Nepal",
    "Nicaragua",
    "Niger",
    "Nigeria",
    "Norvegia",
    "Nuova Zelanda",
    "Oman",
    "Paesi Bassi",
    "Pakistan",
    "Palau",
    "Panama",
    "Papua Nuova Guinea",
    "Paraguay",
    "Perù",
    "Polonia",
    "Portogallo",
    "Qatar",
    "Regno Unito",
    "Repubblica Ceca",
    "Repubblica Centrafricana",
    "Repubblica Dominicana",
    "Romania",
    "Ruanda",
    "Russia",
    "Saint Kitts e Nevis",
    "Saint Lucia",
    "Saint Vincent e Grenadine",
    "Samoa",
    "San Marino",
    "Sao Tomé e Príncipe",
    "Senegal",
    "Serbia",
    "Seychelles",
    "Sierra Leone",
    "Singapore",
    "Slovacchia",
    "Slovenia",
    "Solomon",
    "Somalia",
    "Spagna",
    "Sri Lanka",
    "Stati Uniti",
    "Sudafrica",
    "Sudan",
    "Sudan del Sud",
    "Suriname",
    "Svezia",
    "Svizzera",
    "Siria",
    "Tagikistan",
    "Taiwan",
    "Tanzania",
    "Thailandia",
    "Timor Est",
    "Togo",
    "Tonga",
    "Trinidad e Tobago",
    "Tunisia",
    "Turchia",
    "Turkmenistan",
    "Tuvalu",
    "Ucraina",
    "Uganda",
    "Ungheria",
    "Uruguay",
    "Uzbekistan",
    "Vanuatu",
    "Vaticano",
    "Venezuela",
    "Vietnam",
    "Yemen",
    "Zambia",
    "Zimbabwe"
  ]
},

  data_partenza: { tipo: "date", label: "Data Partenza" },
  primo_giappone: { tipo: "date", label: "Primo giorno in Giappone" },
  ultimo_giappone: { tipo: "date", label: "Ultimo giorno in Giappone" },
  data_ritorno: { tipo: "date", label: "Data Ritorno" },

  preferenze: {
    tipo: "select-multipla",
    opzioni: ["Cucina locale", "Autenticità", "Artigianato", "Shopping", "Cultura", "Folclore", "Mercati", "Natura e paesaggi", "Tradizione", "Altro"]
  },
  esigenze_speciali: {
    tipo: "select-multipla",
    opzioni: ["Allergie stagionali", "Allergie alimentari", "Sedia a rotelle", "Ipovedente", "Problemi uditivi", "Ansia sociale", "Diabete", "Autismo", "Neurodivergenza", "Halal", "Kosher", "Dieta vegana", "Dieta vegetariana", "Celiachia", "Altro"]
  },
  lingue_parlate: {
    tipo: "select-multipla",
    opzioni: ["Italiano", "Inglese", "Francese", "Spagnolo", "Tedesco", "Portoghese", "Russo", "Giapponese", "Cinese", "Coreano"]
  },
  tatuaggi: { tipo: "select-singola", opzioni: ["Sì", "No"] },
  maggiorenne: { tipo: "select-singola", opzioni: ["Sì", "No"] },
  fumatore: { tipo: "select-singola", opzioni: ["Sì", "No"] },
  claustrofobia: { tipo: "select-singola", opzioni: ["Sì", "No"] },
  acrofobia: { tipo: "select-singola", opzioni: ["Sì", "No"] },
  cinetosi: { tipo: "select-singola", opzioni: ["Sì", "No"] },
  stile_comunicativo: {
    tipo: "select-singola",
    opzioni: ["curioso", "rassicurante", "accogliente", "empatico", "stimolante ma chiaro", "tranquillo", "coinvolgente", "familiare", "consapevole", "sereno"]
  },
  approccio_cibo: {
    tipo: "select-singola",
    opzioni: ["Aperto a provare", "Tradizionale", "Internazionale", "Cauto/Selettivo", "Veg/Vegano consapevole"]
  },
  comfort: {
    tipo: "select-singola",
    opzioni: ["Spartano", "Standard", "Premium", "Lusso"]
  },
  autonomia: {
    tipo: "select-singola",
    opzioni: ["Autonomo", "Da accompagnare", "Da guidare passo passo"]
  },
  tipologia_viaggio: {
    tipo: "select-singola",
    opzioni: ["Singolo", "Famiglia", "Amici", "Colleghi", "Gruppo misto"]
  },
  ritmo: {
    tipo: "select-singola",
    opzioni: ["Lento", "Normale", "Veloce"]
  },
  budget: {
    tipo: "select-singola",
    opzioni: ["Ridotto", "Medio", "Alto", "Illimitato"]
  },
  occasione: {
    tipo: "select-singola",
    opzioni: ["Nessuno", "Compleanno", "Viaggio di nozze", "Laurea", "Anniversario", "Addio al nubilato/celibato", "Vacanza", "Romantico", "Altro"]
  },
  numero_viaggiatori: {
    tipo: "select-singola",
    opzioni: ["1", "2", "3", "4", "5", "6"]
  }
};
const MAPPATURA_CAMPI = {
  "Nome": "nome",
  "Nazionalità": "nazionalita",
  "Email": "email",
  "Numero viaggiatori": "numero_viaggiatori",
  "Stile di Comunicazione": "stile_comunicativo",
  "Tipologia gruppo": "tipologia_viaggio",
  "Comfort desiderato": "comfort",
  "Livello autonomia": "autonomia",
  "Ritmo": "ritmo",
  "Preferenze": "preferenze",
  "Esigenze Speciali": "esigenze_speciali",
  "Restrizioni alimentari dettagliate": "restrizioni_alimentari",
  "Approccio al cibo": "approccio_cibo",
  "Tatuaggi": "tatuaggi",
  "Maggiorenne": "maggiorenne",
  "Fumatore": "fumatore",
  "Acrofobia": "acrofobia",
  "Claustrofobia": "claustrofobia",
  "Cinetosi": "cinetosi",
  "Budget stimato al giorno": "budget",
  "Occasione": "occasione",
  "Fascia oraria escursioni": "fascia_oraria_escursioni",  // opzionale
  "Lingua parlata": "lingue_parlate",
  "Data Partenza": "data_partenza",
  "Primo giorno in Giappone": "primo_giappone",
  "Ultimo giorno in Giappone": "ultimo_giappone",
  "Data Ritorno": "data_ritorno",
  "Password_Hash": "password_hash"
};

async function caricaDatiCliente() {
  const codiceCliente = localStorage.getItem("codiceClienteYUTA");

  const response = await fetch("https://yuta-invio-profilo.azurewebsites.net/api/invio-api", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ tipoRichiesta: "get", codice: codiceCliente })
  });

  const dati = await response.json();
const form = document.getElementById("modificaForm");
if (!form) {
  console.error("Form non trovato!");
  return;
}
if (!dati || typeof dati !== "object") {
  console.error("Dati non validi:", dati);
  return;
}

Object.entries(dati).forEach(([keyRaw, value]) => {
  const key = MAPPATURA_CAMPI[keyRaw];
  const campo = CAMPI_DEFINITI[key];
  if (!campo) return;

    const label = document.createElement("label");
    label.textContent = campo.label || key;
    label.htmlFor = `campo-${key}`;

    let input;

    if (campo.tipo === "select-multipla") {
      input = document.createElement("select");
      input.name = key;
      input.id = `campo-${key}`;
      input.multiple = true;

      const selezionati = typeof value === "string" ? value.split(",").map(v => v.trim()) : value || [];

      campo.opzioni.forEach(opt => {
        const option = document.createElement("option");
        option.value = opt;
        option.textContent = opt;
        if (selezionati.includes(opt)) option.selected = true;
        input.appendChild(option);
      });

    } else if (campo.tipo === "select-singola") {
      input = document.createElement("select");
      input.name = key;
      input.id = `campo-${key}`;

      campo.opzioni.forEach(opt => {
        const option = document.createElement("option");
        option.value = opt;
        option.textContent = opt;
        if (String(value).trim() === opt) option.selected = true;
        input.appendChild(option);
      });

  // ✅ Applica Select2 se il campo è "nazionalita"
  if (key === "nazionalita") {
    setTimeout(() => {
      $(`#campo-${key}`).select2({
        placeholder: "Seleziona la tua nazionalità",
        allowClear: true,
        width: "100%"
      });
    }, 0);
  }
}

    } else if (campo.tipo === "text" || campo.tipo === "email") {
      input = document.createElement("input");
      input.type = campo.tipo;
      input.name = key;
      input.id = `campo-${key}`;
      input.value = value || "";

    } else if (campo.tipo === "date") {
      input = document.createElement("input");
      input.type = "date";
      input.name = key;
      input.id = `campo-${key}`;
      if (value) {
        const parsed = new Date(value);
        if (!isNaN(parsed)) {
          input.value = parsed.toISOString().split("T")[0];
        }
      }
    }

    form.appendChild(label);
    form.appendChild(input);
  });
  // ✅ Sezione modifica password
  const separatore = document.createElement("hr");

  const sezionePassword = document.createElement("div");
  sezionePassword.id = "sezionePassword";
  sezionePassword.innerHTML = `
    <h2>Modifica password</h2>
    <div id="formPassword" style="margin-top: 20px;">
      <label for="password_attuale">Password attuale</label>
      <input type="password" id="password_attuale" name="password_attuale" required />
      <button type="button" class="toggle-password-text" onclick="togglePassword('password_attuale', this)">Mostra password</button>

      <label for="nuova_password">Nuova password</label>
      <input type="password" id="nuova_password" name="nuova_password" required />
      <button type="button" class="toggle-password-text" onclick="togglePassword('nuova_password', this)">Mostra password</button>

      <label for="conferma_password">Conferma nuova password</label>
      <input type="password" id="conferma_password" name="conferma_password" required />
      <button type="button" class="toggle-password-text" onclick="togglePassword('conferma_password', this)">Mostra password</button>

      <button type="button" onclick="modificaPassword()">Aggiorna password</button>
    </div>
  `;

  const separatore2 = document.createElement("hr");

  const sezioneComponenti = document.createElement("div");
  sezioneComponenti.id = "sezioneComponenti";
  sezioneComponenti.innerHTML = `
    <h2>Componenti del gruppo</h2>
    <div id="containerComponenti">
      <label for="comp-1">Codice cliente</label>
      <input type="text" name="componenti_gruppo" class="input-componente" id="comp-1" />
    </div>
    <button type="button" onclick="aggiungiComponente()">Aggiungi altro componente</button>
  `;

  form.appendChild(separatore);
  form.appendChild(sezionePassword);
  form.appendChild(separatore2);
  form.appendChild(sezioneComponenti);
}
</script>
<script>
  window.addEventListener("DOMContentLoaded", caricaDatiCliente);
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script src="assets/script.js"></script>
</body>
</html>

